FROM gradle:jdk8-alpine as build_image
RUN mkdir -p /home/gradle/code
RUN mkdir -p /home/gradle/app

COPY --chown=gradle:gradle ./rabKot /home/gradle/code/rabKot
COPY --chown=gradle:gradle ./textConsumer /home/gradle/code/textConsumer

RUN cd /home/gradle/code && \
	cd rabKot && \
	gradle clean jar && \
	cp ./build/libs/*.jar /home/gradle/app/kot_lib.jar && \
	cd /home/gradle/code && \
	cd textConsumer && \
	gradle clean fatJar && \
	cp ./build/libs/*.jar /home/gradle/app/text_consumer.jar && \
	ls /home/gradle/app

RUN rm -rf /home/gradle/code

FROM openjdk:8-jre-alpine
RUN mkdir -p /app

COPY --from=build_image /home/gradle/app/*.jar /app/

ENTRYPOINT ["java", "-jar", "/app/text_consumer.jar"]